<!DOCTYPE html>
<html>
    <head>
        <script src="https://aarondavidnewman.github.io/vexflow_smoosic/releases/vexflow-debug.js"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <style>

            * {
                box-sizing: border-box;
                margin: 0px;
                padding: 0px;
            }

            a:hover {
                cursor: pointer;
            }

            html {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 16px;
            }

            header {
                background-color: orange;
                box-shadow: 0 5px 5px darkorange;
                height: 75px;
                padding: 20px 5px;
                margin-bottom: 50px;
            }

            header h1 {
                display: inline-block;
                width: 60%;
            }

            header nav {
                float: right;
                width: 30%;
            }

            form input[type=submit] {
                font-size: 1rem;
                margin: 10px 35%;
                height: 1.5rem;
                width: 30%;
            }

            form input[type=submit]:hover {
                cursor: pointer;
            }

            header nav a {
                display: inline-block;
                width: 40%;
            }

            label {
                font-weight: bold;
                margin-right: 5px;
            }

            .form-chord {
                display: inline-block;
                margin: 10px 0px;
                width: 48%;
            }

            .form-chord label, .form-select label {
                display: inline-block;
                width: 20%;
            }

            .form-chord input {
                font-size: 0.9rem;
                width: 70%;
            }

            .form-select {
                display: inline-block;
                width: 48%;
            }

            .form-select select {
                font-size: 0.9rem;
                width: 70%;
            }

            .ghost-note {
                opacity: 0;
            }

            #addChordBtn {
                margin: 5px 0px;
            }

            #chord-builder-form {
                border: 2px solid black;
                margin: 0 auto;
                padding: 10px 2%;
                width: 50%;
            }

            #chord-builder-form h2 {
                margin-bottom: 20px;
                text-align: center;
            }

            #progression-chords {
                margin: 20px 0px;
            }

            #stave-svg {
                margin: 0 5%;
                overflow: auto;
                width: 90%;
            }

            button {
                font-size: 0.75rem;
                margin: 0 9%;
                height: 1.5rem;
                width: 30%;
            }

            button:hover {
                cursor: pointer;
            }

        </style>
    </head>
    <body>
        <header>
            <h1>Chord Progression Builder and Analysis Tool</h1>
            <nav>
                <a id="link-howTo" href ="{{ url_for('how_to') }}">How To Use</a>
                <a id="link-satb">SATB Info</a>
            </nav>
        </header>
        <main>
            <!-- Chord Progression builder form -->
            <form action="{{ url_for('analysis') }}" method="POST" id="chord-builder-form" novalidate>
                <h2>Chord Progression Builder Form</h2>
                {{ form.csrf_token }}
                <div class="form-select">
                    {{form.key.label}}{{form.key}}
                </div>
                <div class="form-select">
                    {{form.time.label}}{{form.time}}
                </div>
                <!-- Chord inputs -->
                <div id="progression-chords">
                    {% for chord in form.chords %} 
                    <div class="form-chord">
                        <tr>
                            <td>{{ chord.label }}</td>
                            <td>{{ chord }}</td>
                        </tr>
                    </div>   
                    {% endfor %}
                </div>
                <!-- Button to add new chord input fields -->
                <button id="addChordBtn">Add Chord</button>
                <div>
                    {{form.display_options.label}}
                    {% for option in form.display_options %}
                        <tr>
                            <td>{{ option }}</td>
                            <td>{{ option.label }}</td>
                        </tr>
                    {% endfor %}
                </div>
                {{ form.sample }}
                {{form.submit()}} 
            </form>
            <div id='stave-svg'></div>
        </main>
        <script>

            let addBtn = document.getElementById('addChordBtn');

            addBtn.onclick = (ev) => {
                ev.preventDefault();

                let formChordsSection = document.getElementById('progression-chords');
                let numChords = formChordsSection.children.length;

                let newChordDiv = document.createElement('div');
                newChordDiv.setAttribute('class', 'form-chord');

                let newChordLabel = document.createElement('label');
                newChordLabel.setAttribute('for', 'chords-' + numChords);
                newChordLabel.innerText = "Chord:";

                let newChordInput = document.createElement('input');
                newChordInput.setAttribute('id', 'chords-' + numChords);
                newChordInput.setAttribute('name', 'chords-' + numChords);

                newChordDiv.appendChild(newChordLabel);
                newChordDiv.appendChild(newChordInput);
                formChordsSection.appendChild(newChordDiv);
            }
        </script>

        <!-- Script to build the stave -->
        <script src="{{ url_for('static', filename='scripts/staveBuilder.js') }}"></script>
    </body>
</html>